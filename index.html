<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quest of the Sky Coders - Educational Learning Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div id="root"></div>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #06B6D4;
            --success: #10B981;
            --warning: #F59E0B;
            --error: #EF4444;
            --surface: #FFFFFF;
            --background: #F8FAFC;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --border: #E2E8F0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .game-card {
            background: var(--surface);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 2rem 0;
        }
        
        .character-card {
            background: var(--background);
            border: 3px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .character-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }
        
        .character-card.selected {
            border-color: var(--success);
            background: #F0FDF4;
            transform: translateY(-4px);
        }
        
        .character-card.selected::after {
            content: '✓';
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--success);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .character-image {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            margin-bottom: 12px;
            object-fit: cover;
        }
        
        .character-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .island-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 24px;
            margin: 2rem 0;
        }
        
        .island-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            padding: 24px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .island-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .island-card.completed {
            background: linear-gradient(135deg, var(--success), #059669);
        }
        
        .island-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .island-stars {
            font-size: 1.5rem;
            margin-top: 8px;
        }
        
        .game-area {
            background: var(--surface);
            border-radius: 20px;
            padding: 32px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .question-text {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 24px;
        }
        
        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 24px 0;
        }
        
        .answer-btn {
            background: var(--background);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
        }
        
        .answer-btn:hover {
            border-color: var(--primary);
            background: #EEF2FF;
            transform: translateY(-2px);
        }
        
        .answer-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 8px;
        }
        
        .btn-primary:hover {
            background: #3730A3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: var(--text-secondary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 8px;
        }
        
        .feedback {
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 600;
            text-align: center;
        }
        
        .feedback.correct {
            background: #DCFCE7;
            color: #166534;
            border: 2px solid var(--success);
        }
        
        .feedback.incorrect {
            background: #FEF2F2;
            color: #991B1B;
            border: 2px solid var(--error);
        }
        
        .progress-bar {
            background: var(--border);
            height: 8px;
            border-radius: 4px;
            margin: 16px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            background: var(--success);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .character-guide {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--surface);
            border-radius: 16px;
            padding: 16px;
            box-shadow: var(--shadow);
            text-align: center;
            z-index: 1000;
        }
        
        .character-guide img {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .character-guide-name {
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .switch-btn {
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.7rem;
            cursor: pointer;
        }
        
        @media (max-width: 768px) {
            .game-card {
                padding: 24px;
                margin: 10px;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .character-guide {
                position: relative;
                left: auto;
                top: auto;
                transform: none;
                margin: 16px auto;
                display: inline-block;
            }
        }
    </style>
    <script type="text/babel">
        // Educational content following ADDIE principles
        const LEARNING_CONTENT = {
            fractions: {
                title: "Fraction Adventures",
                questions: [
                    {
                        question: "Which fraction represents the larger part?",
                        answers: ["1/4", "1/2", "1/8", "1/3"],
                        correct: 1,
                        explanation: "1/2 means one out of two equal parts, which is larger than the others."
                    },
                    {
                        question: "Which fraction equals 0.5?",
                        answers: ["1/3", "1/2", "2/3", "3/4"],
                        correct: 1,
                        explanation: "1/2 = 0.5 because 1 divided by 2 equals 0.5."
                    },
                    {
                        question: "Order from smallest to largest: Which comes first?",
                        answers: ["1/2", "1/3", "1/4", "1/5"],
                        correct: 3,
                        explanation: "1/5 is smallest because dividing into more parts makes each part smaller."
                    }
                ]
            },
            vocabulary: {
                title: "Word Discovery",
                questions: [
                    {
                        question: "What does 'enormous' mean?",
                        answers: ["Very small", "Very large", "Very fast", "Very slow"],
                        correct: 1,
                        explanation: "Enormous means extremely large in size or extent."
                    },
                    {
                        question: "Which word means the same as 'happy'?",
                        answers: ["Sad", "Angry", "Joyful", "Tired"],
                        correct: 2,
                        explanation: "Joyful is a synonym for happy - both mean feeling pleasure or contentment."
                    },
                    {
                        question: "What is the opposite of 'difficult'?",
                        answers: ["Hard", "Easy", "Complex", "Tough"],
                        correct: 1,
                        explanation: "Easy is the antonym (opposite) of difficult."
                    }
                ]
            },
            geometry: {
                title: "Shape Explorer",
                questions: [
                    {
                        question: "How many sides does a triangle have?",
                        answers: ["2", "3", "4", "5"],
                        correct: 1,
                        explanation: "A triangle always has exactly 3 sides and 3 angles."
                    },
                    {
                        question: "Which shape has 4 equal sides and 4 right angles?",
                        answers: ["Triangle", "Circle", "Square", "Rectangle"],
                        correct: 2,
                        explanation: "A square has 4 equal sides and 4 right angles (90 degrees each)."
                    },
                    {
                        question: "How many degrees are in a complete circle?",
                        answers: ["180", "270", "360", "450"],
                        correct: 2,
                        explanation: "A complete circle contains 360 degrees."
                    }
                ]
            },
            arithmetic: {
                title: "Number Quest",
                questions: [
                    {
                        question: "What is 15 + 27?",
                        answers: ["41", "42", "43", "44"],
                        correct: 1,
                        explanation: "15 + 27 = 42. You can solve this by adding: 15 + 20 = 35, then 35 + 7 = 42."
                    },
                    {
                        question: "What is 8 × 7?",
                        answers: ["54", "55", "56", "57"],
                        correct: 2,
                        explanation: "8 × 7 = 56. This is 8 groups of 7, or 7 + 7 + 7 + 7 + 7 + 7 + 7 + 7."
                    },
                    {
                        question: "What is 100 ÷ 4?",
                        answers: ["20", "25", "30", "35"],
                        correct: 1,
                        explanation: "100 ÷ 4 = 25. Think: how many groups of 4 make 100? Answer: 25 groups."
                    }
                ]
            },
            logic: {
                title: "Logic Puzzles",
                questions: [
                    {
                        question: "If A > B and B > C, then what is true?",
                        answers: ["A < C", "A = C", "A > C", "Cannot tell"],
                        correct: 2,
                        explanation: "If A is greater than B, and B is greater than C, then A must be greater than C."
                    },
                    {
                        question: "Complete the pattern: 2, 4, 8, 16, ?",
                        answers: ["24", "28", "32", "36"],
                        correct: 2,
                        explanation: "Each number doubles: 2×2=4, 4×2=8, 8×2=16, 16×2=32."
                    },
                    {
                        question: "All birds can fly. Penguins are birds. Therefore:",
                        answers: ["Penguins can fly", "Penguins cannot fly", "The statement is false", "Need more info"],
                        correct: 2,
                        explanation: "The first statement is actually false - not all birds can fly (like penguins)."
                    }
                ]
            },
            science: {
                title: "Science Discovery",
                questions: [
                    {
                        question: "What do plants need to make their own food?",
                        answers: ["Only water", "Only soil", "Sunlight and water", "Only air"],
                        correct: 2,
                        explanation: "Plants use photosynthesis, which requires sunlight, water, and carbon dioxide to make food."
                    },
                    {
                        question: "How many planets are in our solar system?",
                        answers: ["7", "8", "9", "10"],
                        correct: 1,
                        explanation: "There are 8 planets: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, Neptune."
                    },
                    {
                        question: "What gas do humans need to breathe to survive?",
                        answers: ["Carbon dioxide", "Oxygen", "Nitrogen", "Helium"],
                        correct: 1,
                        explanation: "Humans breathe in oxygen and breathe out carbon dioxide."
                    }
                ]
            }
        };

        // Sound system for engagement
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.init();
            }
            
            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
            
            playTone(frequency, duration, type = 'sine') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            playClick() { this.playTone(800, 0.1); }
            playSuccess() { 
                this.playTone(523, 0.2);
                setTimeout(() => this.playTone(659, 0.2), 100);
                setTimeout(() => this.playTone(784, 0.3), 200);
            }
            playError() { this.playTone(300, 0.3, 'sawtooth'); }
        }

        const soundManager = new SoundManager();
        
        // AI Question Generator
        class AIQuestionGenerator {
            constructor() {
                this.apiKey = 'sk-e54878c0baa944c99d251a339d8e6a02';
                this.baseUrl = 'https://api.deepseek.com/chat/completions';
            }
            
            async generateQuestions(subject, age, count = 3) {
                console.log(`Generating ${subject} questions for age ${age}`);
                
                const ageDescriptions = {
                    5: 'kindergarten level with very simple concepts',
                    6: 'first grade level with basic concepts', 
                    7: 'second grade level with elementary concepts',
                    8: 'third grade level with intermediate concepts',
                    9: 'fourth grade level with more complex concepts',
                    10: 'fifth grade level with advanced elementary concepts',
                    11: 'sixth grade level with middle school concepts',
                    12: 'seventh grade level with pre-algebra concepts',
                    13: 'eighth grade level with algebra concepts',
                    14: 'ninth grade level with high school concepts',
                    15: 'tenth grade level with advanced concepts',
                    16: 'eleventh grade level with college prep concepts',
                    17: 'twelfth grade level with advanced high school concepts',
                    18: 'college freshman level concepts'
                };
                
                const ageLevel = ageDescriptions[age] || `grade level appropriate for ${age} years old`;
                
                const prompt = `Create exactly ${count} ${subject} questions for ${ageLevel}. Return ONLY valid JSON in this exact format:
{
  "questions": [
    {
      "question": "Question text here",
      "answers": ["option1", "option2", "option3", "option4"],
      "correct": 0,
      "explanation": "Simple explanation"
    }
  ]
}

Make questions significantly different in difficulty for age ${age}. No extra text, just JSON.`;
                
                try {
                    console.log('Making API request...');
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [{ role: 'user', content: prompt }],
                            temperature: 0.8,
                            max_tokens: 1000
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    const data = await response.json();
                    console.log('API Response:', data);
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${data.error?.message || 'Unknown error'}`);
                    }
                    
                    const content = data.choices[0].message.content;
                    console.log('Generated content:', content);
                    
                    // Clean the content to extract JSON
                    const jsonMatch = content.match(/\{[\s\S]*\}/);
                    if (!jsonMatch) {
                        throw new Error('No JSON found in response');
                    }
                    
                    const result = JSON.parse(jsonMatch[0]);
                    console.log('Parsed result:', result);
                    return result;
                } catch (error) {
                    console.error('AI generation failed:', error);
                    alert(`AI Error: ${error.message}. Using default questions.`);
                    return null;
                }
            }
        }
        
        const aiGenerator = new AIQuestionGenerator();

        // Teacher Dashboard Component
        function TeacherDashboard({ onBack, gameData }) {
            const totalQuestions = gameData.reduce((sum, game) => sum + game.questionsAnswered, 0);
            const correctAnswers = gameData.reduce((sum, game) => sum + game.correctAnswers, 0);
            const accuracy = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            return (
                <div className="game-area">
                    <h2>📊 Teacher Dashboard</h2>
                    <button className="btn-secondary" onClick={onBack}>← Back to Game</button>
                    
                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '20px', margin: '20px 0'}}>
                        <div style={{background: '#F0F9FF', padding: '20px', borderRadius: '12px', border: '2px solid #0EA5E9'}}>
                            <h3 style={{color: '#0369A1', margin: '0 0 10px 0'}}>Total Questions</h3>
                            <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#0369A1'}}>{totalQuestions}</div>
                        </div>
                        <div style={{background: '#F0FDF4', padding: '20px', borderRadius: '12px', border: '2px solid #10B981'}}>
                            <h3 style={{color: '#059669', margin: '0 0 10px 0'}}>Correct Answers</h3>
                            <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#059669'}}>{correctAnswers}</div>
                        </div>
                        <div style={{background: '#FFFBEB', padding: '20px', borderRadius: '12px', border: '2px solid #F59E0B'}}>
                            <h3 style={{color: '#D97706', margin: '0 0 10px 0'}}>Accuracy</h3>
                            <div style={{fontSize: '2rem', fontWeight: 'bold', color: '#D97706'}}>{accuracy}%</div>
                        </div>
                    </div>
                    
                    <div style={{background: '#F8FAFC', padding: '20px', borderRadius: '12px', marginTop: '20px'}}>
                        <h3>Game Performance</h3>
                        {gameData.map((game, index) => (
                            <div key={index} style={{display: 'flex', justifyContent: 'space-between', padding: '10px 0', borderBottom: '1px solid #E2E8F0'}}>
                                <span>{game.subject}</span>
                                <span>{game.correctAnswers}/{game.questionsAnswered} ({game.questionsAnswered > 0 ? Math.round((game.correctAnswers / game.questionsAnswered) * 100) : 0}%)</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        // Age Input Component
        function AgeInput({ onAgeSet }) {
            const [age, setAge] = React.useState('');
            
            const handleSubmit = () => {
                const ageNum = parseInt(age);
                if (ageNum >= 5 && ageNum <= 18) {
                    onAgeSet(ageNum);
                } else {
                    alert('Please enter an age between 5 and 18');
                }
            };
            
            return (
                <div className="game-area">
                    <h2>🎂 What's your age?</h2>
                    <p>This helps us create the perfect questions for you!</p>
                    <input 
                        type="number" 
                        value={age} 
                        onChange={(e) => setAge(e.target.value)}
                        placeholder="Enter your age"
                        style={{
                            padding: '12px 16px',
                            fontSize: '1.2rem',
                            border: '2px solid #E2E8F0',
                            borderRadius: '8px',
                            margin: '20px',
                            width: '200px'
                        }}
                    />
                    <br />
                    <button className="btn-primary" onClick={handleSubmit}>
                        Set My Age
                    </button>
                </div>
            );
        }
        
        // Character Guide Component
        function CharacterGuide({ character, onSwitch }) {
            const characters = {
                luna: { name: 'Luna', image: '../images/Luna.png' },
                max: { name: 'Max', image: '../images/Max.png' },
                wise: { name: 'Professor Wise', image: '../images/wise.png' },
                captain: { name: 'Captain Smart', image: '../images/captain-smart.png' }
            };
            
            const char = characters[character];
            if (!char) return null;
            
            return (
                <div className="character-guide">
                    <img src={char.image} alt={char.name} />
                    <div className="character-guide-name">{char.name}</div>
                    <button className="switch-btn" onClick={onSwitch}>Switch Guide</button>
                </div>
            );
        }

        // Mini Game Component
        function MiniGame({ subject, onComplete, userAge, onGameData }) {
            const [content, setContent] = React.useState(LEARNING_CONTENT[subject]);
            const [isGenerating, setIsGenerating] = React.useState(false);
            const [currentQuestion, setCurrentQuestion] = React.useState(0);
            const [selectedAnswer, setSelectedAnswer] = React.useState(null);
            const [score, setScore] = React.useState(0);
            const [showFeedback, setShowFeedback] = React.useState(false);
            const [gameComplete, setGameComplete] = React.useState(false);
            
            // Generate AI questions on mount if age is provided
            React.useEffect(() => {
                if (userAge) {
                    console.log('User age detected:', userAge, 'Generating AI questions...');
                    generateAIQuestions();
                }
            }, [userAge, subject]);
            
            const generateAIQuestions = async () => {
                setIsGenerating(true);
                try {
                    const aiContent = await aiGenerator.generateQuestions(subject, userAge, 3);
                    if (aiContent && aiContent.questions) {
                        setContent({ title: content.title, questions: aiContent.questions });
                    }
                } catch (error) {
                    console.error('Failed to generate AI questions:', error);
                }
                setIsGenerating(false);
            };
            
            const question = content.questions[currentQuestion];
            const progress = ((currentQuestion + 1) / content.questions.length) * 100;
            
            const selectAnswer = (index) => {
                setSelectedAnswer(index);
                soundManager.playClick();
            };
            
            const checkAnswer = () => {
                if (selectedAnswer === null) return;
                
                const isCorrect = selectedAnswer === question.correct;
                if (isCorrect) {
                    setScore(score + 1);
                    soundManager.playSuccess();
                } else {
                    soundManager.playError();
                }
                setShowFeedback(true);
                
                setTimeout(() => {
                    if (currentQuestion < content.questions.length - 1) {
                        setCurrentQuestion(currentQuestion + 1);
                        setSelectedAnswer(null);
                        setShowFeedback(false);
                    } else {
                        setGameComplete(true);
                    }
                }, 3000);
            };
            
            const finishGame = () => {
                const percentage = (score / content.questions.length) * 100;
                let stars = 1;
                if (percentage >= 100) stars = 3;
                else if (percentage >= 67) stars = 2;
                
                // Report game data to parent
                onGameData({
                    subject: content.title,
                    questionsAnswered: content.questions.length,
                    correctAnswers: score
                });
                
                onComplete(stars);
            };
            
            if (isGenerating) {
                return (
                    <div className="game-area">
                        <h2>🤖 Generating personalized questions...</h2>
                        <p>Creating the perfect challenge for age {userAge}!</p>
                        <div style={{margin: '20px 0', fontSize: '2rem'}}>⏳</div>
                    </div>
                );
            }
            
            if (gameComplete) {
                return (
                    <div className="game-area">
                        <h2>🎉 {content.title} Complete!</h2>
                        <p style={{fontSize: '1.2rem', margin: '20px 0'}}>
                            You scored {score} out of {content.questions.length} questions correctly!
                        </p>
                        <div style={{fontSize: '2rem', margin: '20px 0'}}>
                            {'⭐'.repeat(Math.min(3, Math.max(1, Math.ceil((score / content.questions.length) * 3))))}
                        </div>
                        <button className="btn-primary" onClick={finishGame}>
                            Return to Island Map
                        </button>
                    </div>
                );
            }
            
            return (
                <div className="game-area">
                    <h2>{content.title}</h2>
                    <div className="progress-bar">
                        <div className="progress-fill" style={{width: `${progress}%`}}></div>
                    </div>
                    <p>Question {currentQuestion + 1} of {content.questions.length}</p>
                    
                    <div className="question-text">{question.question}</div>
                    
                    <div className="answers-grid">
                        {question.answers.map((answer, index) => (
                            <button
                                key={index}
                                className={`answer-btn ${selectedAnswer === index ? 'selected' : ''}`}
                                onClick={() => selectAnswer(index)}
                            >
                                {answer}
                            </button>
                        ))}
                    </div>
                    
                    {showFeedback && (
                        <div className={`feedback ${selectedAnswer === question.correct ? 'correct' : 'incorrect'}`}>
                            {selectedAnswer === question.correct ? 
                                `✅ Excellent! ${question.explanation}` : 
                                `❌ Not quite. ${question.explanation}`
                            }
                        </div>
                    )}
                    
                    <button 
                        className="btn-primary" 
                        onClick={checkAnswer}
                        disabled={selectedAnswer === null}
                        style={{opacity: selectedAnswer === null ? 0.5 : 1}}
                    >
                        Check Answer
                    </button>
                </div>
            );
        }

        // Main App Component
        function App() {
            const [selectedCharacter, setSelectedCharacter] = React.useState(null);
            const [gameStarted, setGameStarted] = React.useState(false);
            const [currentIsland, setCurrentIsland] = React.useState(null);
            const [showDashboard, setShowDashboard] = React.useState(false);
            const [userAge, setUserAge] = React.useState(null);
            const [showAgeInput, setShowAgeInput] = React.useState(false);
            const [gameData, setGameData] = React.useState([]);
            const [islands, setIslands] = React.useState([
                { id: 1, name: "Fraction Falls", subject: "fractions", stars: 0, completed: false },
                { id: 2, name: "Word Winds", subject: "vocabulary", stars: 0, completed: false },
                { id: 3, name: "Shape Shores", subject: "geometry", stars: 0, completed: false },
                { id: 4, name: "Number Peaks", subject: "arithmetic", stars: 0, completed: false },
                { id: 5, name: "Logic Lagoon", subject: "logic", stars: 0, completed: false },
                { id: 6, name: "Science Skies", subject: "science", stars: 0, completed: false }
            ]);
            
            const characters = [
                { id: 'luna', name: 'Luna', image: '../images/Luna.png' },
                { id: 'max', name: 'Max', image: '../images/Max.png' },
                { id: 'wise', name: 'Professor Wise', image: '../images/wise.png' },
                { id: 'captain', name: 'Captain Smart', image: '../images/captain-smart.png' }
            ];
            
            const selectCharacter = (characterId) => {
                setSelectedCharacter(characterId);
                soundManager.playClick();
            };
            
            const startGame = () => {
                if (!selectedCharacter) {
                    alert('Please choose your learning guide first!');
                    return;
                }
                setGameStarted(true);
                soundManager.playSuccess();
            };
            
            const selectIsland = (islandId) => {
                setCurrentIsland(islandId);
                soundManager.playClick();
            };
            
            const backToMap = () => {
                setCurrentIsland(null);
            };
            
            const switchCharacter = () => {
                setGameStarted(false);
                setCurrentIsland(null);
            };
            
            const completeGame = (starsEarned) => {
                const updatedIslands = islands.map(island => 
                    island.id === currentIsland 
                        ? { ...island, stars: Math.max(island.stars, starsEarned), completed: true }
                        : island
                );
                setIslands(updatedIslands);
                setCurrentIsland(null);
                soundManager.playSuccess();
            };
            
            const handleGameData = (data) => {
                setGameData(prev => [...prev, data]);
            };
            
            const handleAgeSet = (age) => {
                setUserAge(age);
                setShowAgeInput(false);
            };
            
            // Character Selection Screen
            if (!gameStarted) {
                return (
                    <div className="app-container">
                        <div className="game-card">
                            <h1 className="title">Quest of the Sky Coders</h1>
                            <p className="subtitle">Choose your learning guide and embark on educational adventures!</p>
                            
                            <div className="character-grid">
                                {characters.map(character => (
                                    <div 
                                        key={character.id}
                                        className={`character-card ${selectedCharacter === character.id ? 'selected' : ''}`}
                                        onClick={() => selectCharacter(character.id)}
                                    >
                                        <img src={character.image} alt={character.name} className="character-image" />
                                        <div className="character-name">{character.name}</div>
                                    </div>
                                ))}
                            </div>
                            
                            <button className="btn-primary" onClick={startGame}>
                                🚀 Start Learning Adventure
                            </button>
                            
                            <div style={{marginTop: '2rem', display: 'flex', gap: '10px', justifyContent: 'center', flexWrap: 'wrap'}}>
                                <button className="btn-secondary" onClick={() => setShowDashboard(true)}>
                                    📊 Teacher Dashboard
                                </button>
                                <button className="btn-secondary" onClick={() => setShowAgeInput(true)}>
                                    🤖 Enable AI Questions
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
            
            // Teacher Dashboard Screen
            if (showDashboard) {
                return (
                    <div className="app-container">
                        <div className="game-card">
                            <TeacherDashboard onBack={() => setShowDashboard(false)} gameData={gameData} />
                        </div>
                    </div>
                );
            }
            
            // Age Input Screen
            if (showAgeInput) {
                return (
                    <div className="app-container">
                        <div className="game-card">
                            <AgeInput onAgeSet={handleAgeSet} />
                            <button className="btn-secondary" onClick={() => setShowAgeInput(false)}>
                                ← Back
                            </button>
                        </div>
                    </div>
                );
            }
            
            // Game Screen
            if (currentIsland) {
                const island = islands.find(i => i.id === currentIsland);
                return (
                    <div className="app-container">
                        {selectedCharacter && (
                            <CharacterGuide character={selectedCharacter} onSwitch={switchCharacter} />
                        )}
                        <div className="game-card">
                            <MiniGame 
                                subject={island.subject} 
                                onComplete={completeGame} 
                                userAge={userAge}
                                onGameData={handleGameData}
                            />
                            <button className="btn-secondary" onClick={backToMap}>
                                ← Back to Island Map
                            </button>
                        </div>
                    </div>
                );
            }
            
            // Island Map Screen
            return (
                <div className="app-container">
                    {selectedCharacter && (
                        <CharacterGuide character={selectedCharacter} onSwitch={switchCharacter} />
                    )}
                    <div className="game-card">
                        <h1 className="title">Learning Island Map</h1>
                        <p className="subtitle">Choose an island to start your educational quest!</p>
                        
                        <div className="island-grid">
                            {islands.map(island => (
                                <div 
                                    key={island.id}
                                    className={`island-card ${island.completed ? 'completed' : ''}`}
                                    onClick={() => selectIsland(island.id)}
                                >
                                    <div className="island-name">{island.name}</div>
                                    <div className="island-stars">
                                        {island.stars > 0 ? '⭐'.repeat(island.stars) : '🔒'}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div style={{marginTop: '2rem', padding: '1rem', background: '#F1F5F9', borderRadius: '12px'}}>
                            <p><strong>Progress:</strong> {islands.filter(i => i.completed).length} of {islands.length} islands completed</p>
                            {userAge && <p><strong>Age:</strong> {userAge} years old - AI questions enabled! 🤖</p>}
                        </div>
                        
                        <div style={{marginTop: '1rem', display: 'flex', gap: '10px', justifyContent: 'center', flexWrap: 'wrap'}}>
                            <button className="btn-secondary" onClick={() => setShowDashboard(true)}>
                                📊 Teacher Dashboard
                            </button>
                            <button className="btn-secondary" onClick={() => setShowAgeInput(true)}>
                                🤖 {userAge ? 'Change Age' : 'Enable AI Questions'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>